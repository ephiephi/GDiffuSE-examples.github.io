<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Speech Enhancement â€” Audio & Spectrograms</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background-color: #f8f9fa; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; padding: 2rem 0; margin-bottom: 2rem; border-radius: 10px;
    }
    .header-content { max-width: 1200px; margin: 0 auto; padding: 0 20px; text-align: center; }
    h1 { font-size: 2.5rem; margin-bottom: 0.5rem; font-weight: 300; }
    .subtitle { font-size: 1.1rem; opacity: 0.9; margin-bottom: 1rem; }

    .section { background: white; padding: 2rem; margin-bottom: 2rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { color: #4a5568; margin-bottom: 1.5rem; font-size: 1.8rem; border-bottom: 2px solid #667eea; padding-bottom: 0.5rem; }

    .comparison-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem; }
    .audio-sample { background: #f7fafc; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #667eea; transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .audio-sample:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .audio-sample h3 { color: #2d3748; margin-bottom: 1rem; font-size: 1.1rem; }

    .audio-visual-container { display: flex; gap: 1rem; align-items: flex-start; margin-bottom: 0.3rem; }
    .audio-controls-section, .spectrogram-section { flex: 1; min-width: 250px; }
    audio { width: 100%; height: 40px; }
    .sample-info { font-size: 0.9rem; color: #718096; margin-top: 0.5rem; white-space: pre-line;}

    .spectrogram-container { border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden; background: white; transition: border-color 0.2s ease; }
    .spectrogram-container:hover { border-color: #667eea; }
    .spectrogram-img { width: 100%; height: 150px; object-fit: cover; display: block; cursor: pointer; transition: transform 0.2s ease; }
    .spectrogram-img:hover { transform: scale(1.02); }
    .spectrogram-placeholder {
      width: 100%; height: 150px;
      background: linear-gradient(45deg, #f1f5f9 25%, transparent 25%),
                  linear-gradient(-45deg, #f1f5f9 25%, transparent 25%),
                  linear-gradient(45deg, transparent 75%, #f1f5f9 75%),
                  linear-gradient(-45deg, transparent 75%, #f1f5f9 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
      display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 0.9rem; padding: 1rem;
    }

    /* Modal */
    .spectrogram-modal { display: none; position: fixed; z-index: 2000; inset: 0; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
    .spectrogram-modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); max-width: 90%; max-height: 90%; border-radius: 10px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    .spectrogram-modal-img { width: 100%; height: auto; display: block; }
    .modal-close { position: absolute; top: 15px; right: 25px; color: white; font-size: 35px; font-weight: bold; cursor: pointer; z-index: 2001; background: rgba(0,0,0,0.5); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; }
    .modal-close:hover { background: rgba(255,255,255,0.2); }

    /* Sticky nav */
    .nav-buttons { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); z-index: 1000; }
    .nav-button { display: block; background: #667eea; color: white; padding: 0.5rem; margin-bottom: 0.5rem; border-radius: 50%; text-decoration: none; width: 50px; height: 50px; text-align: center; line-height: 40px; }
    .nav-button:hover { background: #5a67d8; }

    @media (max-width: 768px) {
      .container { padding: 10px; }
      h1 { font-size: 2rem; }
      .nav-buttons { display: none; }
      .audio-visual-container { flex-direction: column; }
      .audio-controls-section, .spectrogram-section { min-width: unset; }
      .spectrogram-img { height: 120px; }
    }
  </style>
</head>
<body>
  <!-- Quick nav -->
  <div class="nav-buttons">
    <a href="#samples" class="nav-button" title="Samples">ðŸŽµ</a>
  </div>

  <header>
    <div class="header-content">
      <h1>GuiDiffSE Speech Enhancement â€” Audio Demo</h1>
      <p class="subtitle">Clean â€¢ Noisy â€¢ Our Method â€¢ SGMSE Method â€” with matched spectrograms</p>
    </div>
  </header>

  <div class="container">
    <section id="samples" class="section">
      <h2>Audio Samples & Spectrograms</h2>
      <p style="color:#718096; margin-bottom:1rem;">
        Click to play audio. Click a spectrogram to enlarge. All spectrograms share a global dB color scale for fair visual comparison.
      </p>
      <div id="samplesContainer"></div>
    </section>
  </div>

  <!-- Spectrogram Modal -->
  <div id="spectrogramModal" class="spectrogram-modal">
    <span class="modal-close" onclick="closeSpectrogramModal()">&times;</span>
    <div class="spectrogram-modal-content">
      <img id="modalSpectrogramImg" class="spectrogram-modal-img" src="" alt="">
    </div>
  </div>


<script>
  // -------- Samples (unchanged) --------
  // const SAMPLES = [
  //   { id: 's001', noiseType: 'BBC', snr: '5 dB' },
  //   { id: 's002', noiseType: 'BBC', snr: '5 dB' },
  //   { id: 's003', noiseType: 'BBC', snr: '0 dB' },
  //   { id: 's004', noiseType: 'BBC', snr: '-5 dB' },
  //   { id: 's005', noiseType: 'BBC', snr: '10 dB' },
  //   { id: 's006', noiseType: 'BBC-high-frequency-Energy', snr: '5 dB' },
  //   { id: 's007', noiseType: 'AR', snr: '5 dB' },
  // ];
    const SAMPLES = [
      { id: 's001', noiseType: 'BBC-NHU05011211', snr: '5 dB' }, //0
      { id: 's002', noiseType: 'BBC-07037651',    snr: '5 dB' }, //5
      { id: 's003', noiseType: 'BBC-NHU05101064',    snr: '0 dB' }, //6
      { id: 's004', noiseType: 'BBC-NHU05095223',    snr: '-5 dB' }, //7
      { id: 's005', noiseType: 'BBC-07015058',    snr: '10 dB' }, //14
      { id: 's006', noiseType: 'BBC-high-freq-07070192',    snr: '5 dB' }, //4
      { id: 's007', noiseType: 'AR',    snr: '5 dB' }, //7
    ];

  // -------- Metrics (fill yours; missing entries are okay) --------
  const METRICS = {
    s001: {
      noisy: { pesq: 1.62, stoi: 0.68, sisdr: -1.3 },
      ours:  { pesq: 2.98, stoi: 0.90, sisdr: 10.7 },
      other: { pesq: 2.75, stoi: 0.87, sisdr:  9.2 },
    },
    s002: {
      noisy: { pesq: 1.55, stoi: 0.66, sisdr: -0.8 },
      ours:  { pesq: 3.05, stoi: 0.92, sisdr: 11.4 },
      other: { pesq: 2.84, stoi: 0.89, sisdr: 10.1 },
    },
    s006: {
      noisy: { pesq: 1.07, stoi: 0.90, sisdr: 5.00,dnsmos: 2.43 },
      ours:  { pesq: 1.60, stoi:0.92 , sisdr: 13.56,dnsmos:3.23 },
      other: { pesq: 1.08, stoi:0.95 , sisdr: 5.94,dnsmos:2.94 },
    },
    // s003: {...} etc.
  };

  // -------- Helper: build info text (first line + metrics on new lines) --------
  function infoWithMetrics(sample, typeKey) {
    // Base line:
    let base = '';
    if (typeKey === 'clean') {
      base = 'Original clean speech';
    } else if (typeKey === 'noisy') {
      const nt = sample.noiseType ? `${sample.noiseType} noise` : 'Noisy mixture';
      base = sample.snr ? `${nt} (SNR: ${sample.snr})` : nt;
    } else if (typeKey === 'ours') {
      base = 'Enhanced by our algorithm';
    } else if (typeKey === 'other') {
      base = 'Enhanced by baseline algorithm';
    }

    // Metrics (if present)
    const m = (METRICS[sample.id] || {})[typeKey];
    if (!m || typeKey === 'clean') return base;

    const lines = [base];
    if (m.dnsmos  != null) lines.push(`DNSMOS: ${m.dnsmos.toFixed(2)}`);
    if (m.pesq  != null) lines.push(`PESQ: ${m.pesq.toFixed(2)}`);
    if (m.stoi  != null) lines.push(`STOI: ${m.stoi.toFixed(2)}`);
    if (m.sisdr != null) lines.push(`SI-SDR: ${m.sisdr.toFixed(1)} dB`);
    return lines.join('\n'); // CSS white-space: pre-line makes this break
  }

  // -------- Card types (use the helper above) --------
  const TYPES = [
    { key: 'clean', label: 'ðŸŽ¤ Clean (reference)',  info: s => infoWithMetrics(s, 'clean') },
    { key: 'noisy', label: 'ðŸ”Š Noisy input',        info: s => infoWithMetrics(s, 'noisy') },
    { key: 'ours',  label: 'ðŸŽ¯ GuiDiffSE(Ours)',     info: s => infoWithMetrics(s, 'ours') },
    { key: 'other', label: 'ðŸ”¬ SGMSE',              info: s => infoWithMetrics(s, 'other') },
  ];

  // -------- Existing helpers/render (unchanged) --------
  let currentAudio = null;
  function playAudio(src) {
    if (currentAudio) { currentAudio.pause(); currentAudio.currentTime = 0; }
    currentAudio = new Audio(src);
    currentAudio.play().catch(() => alert('Audio not found: ' + src));
  }

  function openSpectrogramModal(src, alt) {
    const modal = document.getElementById('spectrogramModal');
    const modalImg = document.getElementById('modalSpectrogramImg');
    modal.style.display = 'block';
    modalImg.src = src;
    modalImg.alt = alt;
    modal.onclick = function (e) { if (e.target === modal) closeSpectrogramModal(); };
  }
  function closeSpectrogramModal() {
    const modal = document.getElementById('spectrogramModal');
    modal.style.display = 'none';
  }
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeSpectrogramModal(); });

  function spectroImgOrPlaceholder(src, label) {
    const esc = s => s.replace(/"/g, '&quot;');
    return `
      <div class="spectrogram-container">
        <img src="${esc(src)}"
             alt="${esc(label)}"
             class="spectrogram-img"
             onclick="openSpectrogramModal('${esc(src)}','${esc(label)}')"
             onerror="this.parentNode.innerHTML='<div class=&quot;spectrogram-placeholder&quot;>ðŸ“Š<br>Spectrogram not available<br><small>Missing: ${esc(src)}</small></div>'">
      </div>`;
  }

  function renderSampleRow(sample) {
    const wrapStart = `<div class="comparison-grid" style="margin-bottom:2rem; grid-template-columns: repeat(2, minmax(280px, 1fr));">`;
    const wrapEnd   = `</div>`;
    const cards = TYPES.map(t => {
      const a = `audio/${sample.id}_${t.key}.wav`;
      const p = `spectrograms/${sample.id}_${t.key}_spec.png`;
      return `
        <div class="audio-sample">
          <h3>${t.label}</h3>
          <div class="audio-visual-container">
            <div class="audio-controls-section">
              <audio controls class="audio-controls">
                <source src="${a}" type="audio/wav">
              </audio>
              <div class="sample-info">${t.info(sample)}</div>
            </div>
            <div class="spectrogram-section">
              ${spectroImgOrPlaceholder(p, t.label + ' â€” ' + sample.id)}
            </div>
          </div>
          <button class="play-button" style="background:#667eea;color:#fff;border:none;padding:0.4rem 0.8rem;border-radius:6px;cursor:pointer;"
            onclick="playAudio('${a}')">â–¶ Play</button>
        </div>`;
    }).join('\n');

    return `
      <h3 style="margin:0.4rem 0 0.8rem; color:#4a5568;">Sample ${sample.id}</h3>
      ${wrapStart}${cards}${wrapEnd}
    `;
  }

  // Render all samples
  const container = document.getElementById('samplesContainer');
  container.innerHTML = SAMPLES.map(renderSampleRow).join('\n');
</script>


  <!-- <script>
    /* ---------- Configure your sample IDs here ---------- */
    // Add as many as you want. 'noiseType' and 'snr' are optional labels.
    const SAMPLES = [
      { id: 's001', noiseType: 'BBC', snr: '5 dB' }, //0
      { id: 's002', noiseType: 'BBC',    snr: '5 dB' }, //5
      { id: 's003', noiseType: 'BBC',    snr: '0 dB' }, //6
      { id: 's004', noiseType: 'BBC',    snr: '-5 dB' }, //7
      { id: 's005', noiseType: 'BBC',    snr: '10 dB' }, //14
      { id: 's006', noiseType: 'BBC-high-frequency-Energy',    snr: '5 dB' }, //4
      { id: 's007', noiseType: 'AR',    snr: '5 dB' }, //7
    ];

    // Expected file naming:
    // audio/<id>_clean.wav,  audio/<id>_noisy.wav, audio/<id>_noise.wav,
    // audio/<id>_ours.wav,   audio/<id>_other.wav
    // spectrograms/<id>_clean_spec.png, ... _noisy_spec.png, _noise_spec.png,
    // _ours_spec.png, _other_spec.png

    const TYPES = [
      { key: 'clean', label: 'ðŸŽ¤ Clean (reference)',  info: sid => 'Original clean speech' },
      { key: 'noisy', label: 'ðŸ”Š Noisy input',        info: sid => (sid.noiseType ? `${sid.noiseType} noise` : 'Noisy mixture') + (sid.snr ? ` (SNR: ${sid.snr})` : '') },
      // { key: 'noise', label: 'ðŸŽµ Noise component',    info: sid => 'Estimated / extracted noise' },
      { key: 'ours',  label: 'ðŸŽ¯ GuiDiffSE(Ours)',         info: sid => 'Enhanced by our algorithm' },
      { key: 'other', label: 'ðŸ”¬ SGMSE',       info: sid => 'Enhanced by baseline algorithm' },
    ];

    let currentAudio = null;
    function playAudio(src) {
      if (currentAudio) { currentAudio.pause(); currentAudio.currentTime = 0; }
      currentAudio = new Audio(src);
      currentAudio.play().catch(() => alert('Audio not found: ' + src));
    }

    function openSpectrogramModal(src, alt) {
      const modal = document.getElementById('spectrogramModal');
      const modalImg = document.getElementById('modalSpectrogramImg');
      modal.style.display = 'block';
      modalImg.src = src;
      modalImg.alt = alt;
      modal.onclick = function (e) { if (e.target === modal) closeSpectrogramModal(); };
    }
    function closeSpectrogramModal() {
      const modal = document.getElementById('spectrogramModal');
      modal.style.display = 'none';
    }
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeSpectrogramModal(); });

    function spectroImgOrPlaceholder(src, label) {
      const esc = s => s.replace(/"/g, '&quot;');
      return `
        <div class="spectrogram-container">
          <img src="${esc(src)}"
               alt="${esc(label)}"
               class="spectrogram-img"
               onclick="openSpectrogramModal('${esc(src)}','${esc(label)}')"
               onerror="this.parentNode.innerHTML='<div class=&quot;spectrogram-placeholder&quot;>ðŸ“Š<br>Spectrogram not available<br><small>Missing: ${esc(src)}</small></div>'">
        </div>`;
    }

    function renderSampleRow(sample) {
      // const wrapStart = `<div class="comparison-grid" style="margin-bottom:2rem;">`;
      const wrapStart = `<div class="comparison-grid" style="margin-bottom:2rem; grid-template-columns: repeat(2, minmax(280px, 1fr));">`;
      const wrapEnd   = `</div>`;
      const cards = TYPES.map(t => {
        const a = `audio/${sample.id}_${t.key}.wav`;
        const p = `spectrograms/${sample.id}_${t.key}_spec.png`;
        return `
          <div class="audio-sample">
            <h3>${t.label}</h3>
            <div class="audio-visual-container">
              <div class="audio-controls-section">
                <audio controls class="audio-controls">
                  <source src="${a}" type="audio/wav">
                </audio>
                <div class="sample-info">${t.info(sample)}</div>
              </div>
              <div class="spectrogram-section">
                ${spectroImgOrPlaceholder(p, t.label + ' â€” ' + sample.id)}
              </div>
            </div>
            <button class="play-button" style="background:#667eea;color:#fff;border:none;padding:0.4rem 0.8rem;border-radius:6px;cursor:pointer;"
              onclick="playAudio('${a}')">â–¶ Play</button>
          </div>`;
      }).join('\n');

      return `
        <h3 style="margin:0.4rem 0 0.8rem; color:#4a5568;">Sample ${sample.id}</h3>
        ${wrapStart}${cards}${wrapEnd}
      `;
    }

    // Render all samples
    const container = document.getElementById('samplesContainer');
    container.innerHTML = SAMPLES.map(renderSampleRow).join('\n');
  </script> -->
</body>
</html>
